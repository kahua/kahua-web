# Makefile for kahua-web
# $Id: Makefile.in,v 1.9 2004/04/05 02:35:14 nobsun Exp $

package	          = kahua-web
kahua		  = kahua
SHELL             = @SHELL@
prefix            = @prefix@
exec_prefix       = @exec_prefix@
bindir            = @bindir@/$(kahua)
sbindir           = @sbindir@/$(kahua)
libexecdir	  = @libexecdir@/$(kahua)
datadir		  = @datadir@/$(kahua)
sysconfdir        = @sysconfdir@/$(kahua)
sharedstatedir    = @sharedstatedir@/$(kahua)
localstatedir     = @localstatedir@/$(kahua)
libdir            = @libdir@/$(kahua)
includedir        = @includedir@/$(kahua)
oldincludedir     = @oldincludedir@/$(kahua)
infodir           = @infodir@/$(kahua)
mandir            = @mandir@/$(kahua)
srcdir            = @srcdir@
VPATH             = $(srcdir)
top_builddir      = @top_builddir@
top_srcdir        = @top_srcdir@

DESTDIR  =

GOSH = @GOSH@
KAHUA_INSTALL = @KAHUA_INSTALL@
KAHUA_SERVER  = @KAHUA_SERVER@
KAHUA_WORKING = $(localstatedir)
KAHUA_LIB     = $(libdir)


# specify -c ../kahua.conf etc. to give an alternative conf file
KAHUACONFIG = -c $(sysconfdir)/kahua.conf

SCRIPTFILES = kahua-web/kahua-web.kahua \
              kahua-web/macro.kahua \
	      kahua-web/login.kahua \
              kahua-web/mailform.kahua \
	      kahua-web/search.kahua

STATICFILES = kahua-web/kahua-web.css

SOURCEDIR   = kahua-web
PLUGINFILE  = wiliki.scm

CONFIG_GENERATED = Makefile VERSION test/test.scm \
		   config.log config.status autom4* \
.PHONY: all check clean distclean install maintainer-clean

all:	test/test.scm

test/test.scm:	test/test.scm.in
	sed -e "s@##GOSH##@$(GOSH)@" -e "s@##KAHUA_SERVER##@$(libexecdir)/kahua-server.scm@" -e "s@##KAHUA_WORKING##@$(KAHUA_WORKING)@" -e "s@##KAHUA_LIB##@$(KAHUA_LIB)@" $< > $@

check:  test/test.scm
	rm -f test/test.log
	cd test; $(GOSH) -I$(KAHUA_LIB) ./test.scm > test.log

clean:
	rm -rf core *~ kahua-web/*~ test/*~ test/_* test/test.log

install: 
	$(KAHUA_INSTALL) $(KAHUACONFIG) -t script $(SCRIPTFILES)
	$(KAHUA_INSTALL) $(KAHUACONFIG) -t static $(STATICFILES)
	$(KAHUA_INSTALL) $(KAHUACONFIG) -t plugin -r $(PLUGINFILE) \
                                        $(SOURCEDIR)/$(PLUGINFILE)
	$(GOSH) -I$(libdir) ./init.scm $(KAHUACONFIG)

uninstall :
	$(KAHUA_INSTALL) -U $(KAHUACONFIG) -t script $(SCRIPTFILES)
	$(KAHUA_INSTALL) -U $(KAHUACONFIG) -t static $(STATICFILES)
	$(KAHUA_INSTALL) -U $(KAHUACONFIG) -t plugin -r $(PLUGINFILE) \
                                        $(SOURCEDIR)/$(PLUGINFILE)


distclean: clean
	rm -rf $(CONFIG_GENERATED)

maintainer-clean: clean
	rm -rf $(CONFIG_GENERATED) configure



